[build]
  # Base directory (project root)
  base = "."
  # Build command for React app
  command = "npm run build"
  # Output directory for React build - changed to bust Netlify cache
  publish = "client/dist"
  # Functions directory
  functions = "netlify/functions"

[build.environment]
  # Node version - Vite requires >= 20.19.0
  NODE_VERSION = "20.19.0"
  # Secrets scanning - allow public Supabase keys in client bundle
  SECRETS_SCAN_OMIT_KEYS = "VITE_SUPABASE_ANON_KEY,VITE_SUPABASE_URL"

# Redirect rules for SPA routing
[[redirects]]
  from = "/api/contact"
  to = "/.netlify/functions/contact"
  status = 200

[[redirects]]
  from = "/api/chat"
  to = "/.netlify/functions/chat"
  status = 200

# SPA routing - redirect all routes to index.html for React Router
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# Headers for security
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"

# Production context - login explicitly disabled
[context.production]
  command = "npm run build"
  publish = "client/dist"

[context.production.environment]
  NODE_VERSION = "20.19.0"
  VITE_ENABLE_LOGIN = "false"

# Branch deploy context for staging
[context.staging]
  command = "npm run build"
  publish = "client/dist"

[context.staging.environment]
  NODE_VERSION = "20.19.0"
  VITE_ENABLE_LOGIN = "true"

# Branch deploy context for development
[context.development]
  command = "npm run build"
  publish = "client/dist"

[context.development.environment]
  NODE_VERSION = "20.19.0"
  VITE_ENABLE_LOGIN = "true"

# Environment variables (set in Netlify dashboard, NOT here)
# VITE_SUPABASE_URL = "your-supabase-url"
# VITE_SUPABASE_ANON_KEY = "your-supabase-anon-key"  
# SUPABASE_SERVICE_ROLE_KEY = "your-supabase-service-role-key"
